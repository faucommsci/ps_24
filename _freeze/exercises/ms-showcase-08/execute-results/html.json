{
  "hash": "2fd4dcb1904ac2d0f77f9b7cd3230362",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Text processing in R\"\nsubtitle: \"Session 08 - Showcase\"\ndate: last-modified\ndate-format: \"DD.MM.YYYY\"\n---\n\n\n::: {.callout-tip icon=\"false\"}\n[![Quarto Slide](https://raw.githubusercontent.com/faucommsci/teaching_materials/main/images/badges/badge-quarto-slide.svg)](https://github.com/faucommsci/ps_24/blob/main/slides/ms-slides-08.qmd) Link to slides \n:::\n\n## Preparation\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    here, qs, # file management\n    magrittr, janitor, # data wrangling\n    easystats, sjmisc, # data analysis\n    gt, gtExtras, # table visualization\n    ggpubr, ggwordcloud, # visualization\n    tidytext, widyr, # text analysis    \n    openalexR, \n    tidyverse # load last to avoid masking issues\n  )\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n\n## Codechunks aus der Sitzung\n\n### Erstelle Subsample\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreview_subsample <- review_works_correct %>% \n  # Eingrenzung: Sprache und Typ\n  filter(language == \"en\") %>% \n  filter(type == \"article\") %>%\n  # Datentranformation\n  unnest(topics, names_sep = \"_\") %>%\n  filter(topics_name == \"field\") %>% \n  filter(topics_i == \"1\") %>% \n  # Eingrenzung: Forschungsfeldes\n  filter(\n   topics_display_name == \"Social Sciences\"|\n   topics_display_name == \"Psychology\"\n    )\n```\n:::\n\n\n### Subsample im Zeitverlauf\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nreview_works_correct %>% \n  mutate(\n    included = ifelse(id %in% review_subsample$id, \"Ja\", \"Nein\"),\n    included = factor(included, levels = c(\"Nein\", \"Ja\"))\n    ) %>%\n  ggplot(aes(x = publication_year_fct, fill = included)) +\n    geom_bar() +\n    labs(\n      x = \"\",\n      y = \"Anzahl der Einträge\", \n      fill = \"In Subsample enthalten?\"\n     ) +\n    scale_fill_manual(values = c(\"#A0ACBD50\", \"#FF707F\")) +\n    theme_pubr() \n```\n\n::: {.cell-output-display}\n![](ms-showcase-08_files/figure-html/figure-subsample-distribution-over-time-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Tokenization der Abstracts\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create tidy data\nreview_tidy <- review_subsample %>% \n    # Tokenization\n    tidytext::unnest_tokens(\"text\", ab) %>% \n    # Remove stopwords\n    filter(!text %in% tidytext::stop_words$word)\n\n# Preview\nreview_tidy %>% \n  select(id, text) %>% \n  print(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4,880,965 × 2\n   id                               text          \n   <chr>                            <chr>         \n 1 https://openalex.org/W4293003987 5             \n 2 https://openalex.org/W4293003987 item          \n 3 https://openalex.org/W4293003987 world         \n 4 https://openalex.org/W4293003987 health        \n 5 https://openalex.org/W4293003987 organization  \n 6 https://openalex.org/W4293003987 index         \n 7 https://openalex.org/W4293003987 5             \n 8 https://openalex.org/W4293003987 widely        \n 9 https://openalex.org/W4293003987 questionnaires\n10 https://openalex.org/W4293003987 assessing     \n# ℹ 4,880,955 more rows\n```\n\n\n:::\n:::\n\n\n#### Vergleich eines Abstraktes in Rohform und nach Tokenisierung\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreview_subsample$ab[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"The 5-item World Health Organization Well-Being Index (WHO-5) is among the most widely used questionnaires assessing subjective psychological well-being. Since its first publication in 1998, the WHO-5 has been translated into more than 30 languages and has been used in research studies all over the world. We now provide a systematic review of the literature on the WHO-5.We conducted a systematic search for literature on the WHO-5 in PubMed and PsycINFO in accordance with the PRISMA guidelines. In our review of the identified articles, we focused particularly on the following aspects: (1) the clinimetric validity of the WHO-5; (2) the responsiveness/sensitivity of the WHO-5 in controlled clinical trials; (3) the potential of the WHO-5 as a screening tool for depression, and (4) the applicability of the WHO-5 across study fields.A total of 213 articles met the predefined criteria for inclusion in the review. The review demonstrated that the WHO-5 has high clinimetric validity, can be used as an outcome measure balancing the wanted and unwanted effects of treatments, is a sensitive and specific screening tool for depression and its applicability across study fields is very high.The WHO-5 is a short questionnaire consisting of 5 simple and non-invasive questions, which tap into the subjective well-being of the respondents. The scale has adequate validity both as a screening tool for depression and as an outcome measure in clinical trials and has been applied successfully across a wide range of study fields.\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nreview_tidy %>% \n  filter(id == \"https://openalex.org/W4293003987\") %>% \n  pull(text) %>% \n  paste(collapse = \" \")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"5 item world health organization index 5 widely questionnaires assessing subjective psychological publication 1998 5 translated 30 languages research studies world provide systematic review literature 5 conducted systematic search literature 5 pubmed psycinfo accordance prisma guidelines review identified articles focused aspects 1 clinimetric validity 5 2 responsiveness sensitivity 5 controlled clinical trials 3 potential 5 screening tool depression 4 applicability 5 study fields.a total 213 articles met predefined criteria inclusion review review demonstrated 5 clinimetric validity outcome measure balancing unwanted effects treatments sensitive specific screening tool depression applicability study fields high.the 5 short questionnaire consisting 5 simple invasive questions tap subjective respondents scale adequate validity screening tool depression outcome measure clinical trials applied successfully wide range study fields\"\n```\n\n\n:::\n:::\n\n\n\n### Count token frequency\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create summarized data\nreview_summarized <- review_tidy %>% \n  count(text, sort = TRUE) \n\n# Preview Top 15 token\nreview_summarized %>% \n    print(n = 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 122,148 × 2\n   text              n\n   <chr>         <int>\n 1 studies       73398\n 2 review        57878\n 3 research      42689\n 4 health        35108\n 5 systematic    32431\n 6 literature    31374\n 7 study         29012\n 8 interventions 22731\n 9 included      21987\n10 social        21528\n11 articles      20631\n12 results       20166\n13 analysis      19624\n14 based         18929\n15 evidence      18545\n# ℹ 122,133 more rows\n```\n\n\n:::\n:::\n\n\n## The (Unavoidable) Word Cloud\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nreview_summarized %>% \n    top_n(50) %>% \n    ggplot(aes(label = text, size = n)) +\n    ggwordcloud::geom_text_wordcloud() +\n    scale_size_area(max_size = 20) +\n    theme_minimal()\n```\n\n::: {.cell-output-display}\n![](ms-showcase-08_files/figure-html/figure-wordcloud-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n### Wortkombinationen (n-grams) \n\n::: {.cell}\n\n```{.r .cell-code}\n# Create word paris\nreview_word_pairs <- review_tidy %>% \n    widyr::pairwise_count(\n        text,\n        id,\n        sort = TRUE)\n\n# Preview\nreview_word_pairs %>% \n    print(n = 14)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 114,446,724 × 3\n   item1      item2          n\n   <chr>      <chr>      <dbl>\n 1 review     studies    20494\n 2 studies    review     20494\n 3 review     systematic 20266\n 4 systematic review     20266\n 5 review     research   16902\n 6 research   review     16902\n 7 literature review     16754\n 8 review     literature 16754\n 9 systematic studies    16097\n10 studies    systematic 16097\n11 study      review     13391\n12 review     study      13391\n13 studies    research   13173\n14 research   studies    13173\n# ℹ 114,446,710 more rows\n```\n\n\n:::\n:::\n\n\n### Wortkorrelationen\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create word correlation\nreview_pairs_corr <- review_tidy %>% \n    group_by(text) %>% \n    filter(n() >= 300) %>% \n    pairwise_cor(\n        text, \n        id, \n        sort = TRUE)\n\n# Preview\nreview_pairs_corr %>% \n    print(n = 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5,529,552 × 3\n   item1      item2      correlation\n   <chr>      <chr>            <dbl>\n 1 ottawa     newcastle        0.977\n 2 newcastle  ottawa           0.977\n 3 briggs     joanna           0.967\n 4 joanna     briggs           0.967\n 5 scholar    google           0.938\n 6 google     scholar          0.938\n 7 obsessive  compulsive       0.929\n 8 compulsive obsessive        0.929\n 9 nervosa    anorexia         0.893\n10 anorexia   nervosa          0.893\n11 ci         95               0.887\n12 95         ci               0.887\n13 las        los              0.886\n14 los        las              0.886\n15 gay        bisexual         0.861\n# ℹ 5,529,537 more rows\n```\n\n\n:::\n:::\n\n\n### Spezifische \"Partner\" in spezifischen Umgebungen\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nreview_pairs_corr %>% #| \n  filter(\n    item1 %in% c(\n      \"review\",\n      \"literature\",\n      \"systematic\")\n    ) %>% \n  group_by(item1) %>% \n  slice_max(correlation, n = 5) %>% \n  ungroup() %>% \n  mutate(\n    item2 = reorder(item2, correlation)\n    ) %>% \n  ggplot(\n    aes(item2, correlation, fill = item1)\n    ) +\n  geom_bar(stat = \"identity\") +\n  facet_wrap(~ item1, scales = \"free_y\") +\n  coord_flip() +\n  scale_fill_manual(\n    values = c(\n      \"#04316A\",\n      \"#C50F3C\",\n      \"#00B2D1\")) +\n  theme_pubr()\n```\n\n::: {.cell-output-display}\n![](ms-showcase-08_files/figure-html/figure-word-pairs-correlates-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Die häufigsten \"positiven\" und \"negativen\" Wörter in den Abstracts\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nreview_sentiment_count <- review_tidy %>% \n  inner_join(\n     get_sentiments(\"bing\"),\n     by = c(\"text\" = \"word\"),\n     relationship = \"many-to-many\") %>% \n  count(text, sentiment)\n  \n# Preview\nreview_sentiment_count %>% \n  group_by(sentiment) %>%\n  slice_max(n, n = 10) %>% \n  ungroup() %>% \n  mutate(text = reorder(text, n)) %>%\n  ggplot(aes(n, text, fill = sentiment)) +\n  geom_col(show.legend = FALSE) +\n  facet_wrap(\n    ~sentiment, scales = \"free_y\") +\n  labs(x = \"Contribution to sentiment\",\n       y = NULL) +\n  scale_fill_manual(\n    values = c(\"#C50F3C\", \"#007900\")) +\n  theme_pubr()\n```\n\n::: {.cell-output-display}\n![](ms-showcase-08_files/figure-html/figure-sentiment-most-frequent-words-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Verknüpfung des Sentiemnt (\"Scores\") mit den Abstracts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreview_sentiment <- review_tidy %>% \n  inner_join(\n     get_sentiments(\"bing\"),\n     by = c(\"text\" = \"word\"),\n     relationship = \"many-to-many\") %>% \n  count(id, sentiment) %>% \n  pivot_wider(names_from = sentiment, values_from = n, values_fill = 0) %>% \n  mutate(sentiment = positive - negative)\n  \n# Check\nreview_sentiment \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 35,710 × 4\n   id                               negative positive sentiment\n   <chr>                               <int>    <int>     <int>\n 1 https://openalex.org/W1000529773        2        2         0\n 2 https://openalex.org/W1006561082        0        1         1\n 3 https://openalex.org/W100685805         4       15        11\n 4 https://openalex.org/W1007410967        0        7         7\n 5 https://openalex.org/W1008209175        8        1        -7\n 6 https://openalex.org/W1009104829        2        4         2\n 7 https://openalex.org/W1009607471       15        8        -7\n 8 https://openalex.org/W1031503832       13        6        -7\n 9 https://openalex.org/W1035654938       10        5        -5\n10 https://openalex.org/W1044055445        5        0        -5\n# ℹ 35,700 more rows\n```\n\n\n:::\n:::\n\n\n### Verteilung des Sentiment (Scores) in den Abstracts\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4858737\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nreview_sentiment %>% \n  ggplot(aes(sentiment)) +\n  geom_histogram(binwidth = 0.5, fill = \"#FF707F\") +\n  labs(\n    x = \"Sentiment (Score) des Abstracts\", \n    y = \"Anzahl der Einträge\"\n  ) +\n  theme_pubr() +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))\n```\n\n::: {.cell-output-display}\n![](ms-showcase-08_files/figure-html/figure-sentiment-distribution-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Entwicklung des Sentiment (Scores) der Abstracts im Zeitverlauf\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Create first graph\ng1 <- review_works_correct %>% \n  filter(id %in% review_sentiment$id) %>% \n  left_join(review_sentiment, by = join_by(id)) %>% \n  sjmisc::rec(\n    sentiment,\n    rec = \"min:-2=negative; -1:1=neutral; 2:max=positive\") %>% \n  ggplot(aes(x = publication_year_fct, fill = as.factor(sentiment_r))) +\n    geom_bar() +\n    labs(\n      x = \"\",\n      y = \"Anzahl der Einträge\", \n      fill = \"Sentiment (Score)\") +\n    scale_fill_manual(values = c(\"#C50F3C\", \"#90A0AF\", \"#007900\")) +\n    theme_pubr() \n    #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))\n\n# Create second graph\ng2 <- review_works_correct %>% \n  filter(id %in% review_sentiment$id) %>% \n  left_join(review_sentiment, by = join_by(id)) %>% \n  sjmisc::rec(\n    sentiment,\n    rec = \"min:-2=negative; -1:1=neutral; 2:max=positive\") %>% \n  ggplot(aes(x = publication_year_fct, fill = as.factor(sentiment_r))) +\n    geom_bar(position = \"fill\") +\n    labs(\n      x = \"\",\n      y = \"Anteil der Einträge\", \n      fill = \"Sentiment (Score)\") +\n    scale_fill_manual(values = c(\"#C50F3C\", \"#90A0AF\", \"#007D29\")) +\n    theme_pubr() \n\n# COMBINE GRPAHS\nggarrange(g1, g2,\n          nrow = 1, ncol = 2, \n          align = \"hv\",\n          common.legend = TRUE) \n```\n\n::: {.cell-output-display}\n![](ms-showcase-08_files/figure-html/figure-sentiment-distribution-over-time-1.png){fig-align='center' width=672}\n:::\n:::\n",
    "supporting": [
      "ms-showcase-08_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}